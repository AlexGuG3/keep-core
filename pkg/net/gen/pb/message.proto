syntax = "proto3";

option go_package = "pb";
package net;

// NetworkEnvelope contains a marshalled message, as well as a signature over the
// the contents of the message (to ensure an adversary hasn't tampered
// with the contents).
message NetworkEnvelope {
  // The marshalled network message.
  bytes network_message = 1;

  // Signature over the network message.
  bytes signature = 2;
}

// Message contains a marshalled payload. It also contains the Identities of
// the sender and receiver. Optionally, a Message may contain an encrypted
// payload for messages which need to be secret; in this case, the encrypted
// field will be set.
message NetworkMessage {
  // The PublicKey of the sender.
  bytes sender = 1;

  // The PublicKey of the recipient.
  bytes recipient = 2;

  // A flag indicating whether the payload is encrypted.
  bool encrypted = 3;

  // A marshaled Protocol Message.
  bytes payload = 4;

  // Type of the message as registered by the protocol.
  bytes type = 5;

  // Channel is the group name as well as the pubsub channel
  // Channel names are Keccak(StakingPubKey1 || ... || StakingPubKeyN) of
  // all valid group members.
  bytes channel = 6;

  // Proof that the peer that sent this message knows the channel's name.
  bytes channel_MAC = 7;

  // Per RFC 2, Section 1.2.5: 
  // The nonce is included in a message in a way that makes it a part of the
  // content used to produce a signature.
  bytes nonce = 8;
}

message Identity {
  bytes pub_key = 1;
}
